# 微服务限流器与断路器使用
## 限流器与断路器在微服务中的作用
### 限流器
#### 定义
对某个接口的单位时间的访问量进行限制
#### 作用
在服务承载能力有限时，保证服务不在瞬时流量给打崩
拒绝超过服务器承载能力的流量
坏处：超出服务承载能力的请求会被抛弃(得不到对应的结果)

当有大流量进来时：
1. 横向扩展服务器
2. 横向扩展来不及，则使用限流器，限制流量，比如说 重定向到一个固定的页面
### 断路器(类似电表的保险丝)
#### 定义
在某个时间段中当服务连续报错，超过一定阈值时，打开断路器使得服务或者服务某个接口不可用
#### 作用
防止在服务不可用的情况下造成服务雪崩
## 限流器的视线并集成到 gin
### 实现逻辑
1. 创建一个固定大小的桶，桶里面装着令牌
2. 按一定速率对桶里的令牌进行补充
3. 没进行一次访问，减少桶里现有的令牌数
4. 令牌最多补充到桶的大小
## 断路器的实现并集成到 gin
1. 时间周期（单位时间），记录连续的成功和连续的失败次数
2. 单位时间内连续成功或者连续的失败次数是否达到了阈值
3. 如果连续失败达到阈值，断路器由闭合状态转为打开状态，下一个单位时间不让访问
4. 当打开状态持续一个单位时间，将打开状态转为半开状态，有限制的访问(比如说在这段时间内请求不超过 5 次)
- 断路器里包含了限流器
5. 半开状态下，连续成功次数达到阈值，则转为关闭状态